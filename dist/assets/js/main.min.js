angular.module("20wise",["ui.bootstrap"]);var CharacterService=function(){this.array=[{img:"bowser-jr.png",name:"Bowser Jr."},{img:"bowser.png",name:"Bowser"},{img:"captain-falcon.png",name:"Captain Falcon"},{img:"charizard.png",name:"Charizard"},{img:"cloud.png",name:"Cloud"},{img:"dark-pit.png",name:"Dark Pit"},{img:"dedede.png",name:"King Dedede"},{img:"diddy.png",name:"Diddy Kong"},{img:"donkey.png",name:"Donkey Kong"},{img:"dr-mario.png",name:"Dr. Mario"},{img:"duck-hunt.png",name:"Duo Duck Hunt"},{img:"falco.png",name:"Falco"},{img:"fox.png",name:"Fox"},{img:"game-watch.png",name:"Game&Watch"},{img:"ganondorf.png",name:"Ganondorf"},{img:"greninja.png",name:"Greninja"},{img:"ike.png",name:"Ike"},{img:"jigglypuff.png",name:"Jigglypuff"},{img:"kirby.png",name:"Kirby"},{img:"link.png",name:"Link"},{img:"little-mac.png",name:"Little Mac"},{img:"lucario.png",name:"Lucario"},{img:"lucas.png",name:"Lucas"},{img:"lucina.png",name:"Lucina"},{img:"luigi.png",name:"Luigi"},{img:"mario.png",name:"Mario"},{img:"marth.png",name:"Marth"},{img:"mega-man.png",name:"Mega Man"},{img:"meta-knight.png",name:"Meta Knight"},{img:"mewtwo.png",name:"Mewtwo"},{img:"mii-brawler.png",name:"Mii Brawler"},{img:"mii-gunner.png",name:"Mii Gunner"},{img:"mii-swordfighter.png",name:"Mii Swordfighter"},{img:"ness.png",name:"Ness"},{img:"olimar.png",name:"Olimar"},{img:"pac-man.png",name:"Pac-Man"},{img:"palutena.png",name:"Palutena"},{img:"peach.png",name:"Peach"},{img:"pikachu.png",name:"Pikachu"},{img:"pit.png",name:"Pit"},{img:"robin.png",name:"Robin"},{img:"rob.png",name:"Rob"},{img:"rosalina.png",name:"Rosalina"},{img:"roy.png",name:"Roy"},{img:"ryu.png",name:"Ryu"},{img:"samus.png",name:"Samus"},{img:"sheik.png",name:"Sheik"},{img:"shulk.png",name:"Shulk"},{img:"sonic.png",name:"Sonic"},{img:"toon-link.png",name:"Toon Link"},{img:"villager.png",name:"Villager"},{img:"wario.png",name:"Wario"},{img:"wii-fit-trainer.png",name:"Wii Fit Trainer"},{img:"yoshi.png",name:"Yoshi"},{img:"zelda.png",name:"Zelda"},{img:"zero-suit-samus.png",name:"Zero Suit Samus"}]};angular.module("20wise").service("characters",[CharacterService]);var GAMESTATE={IDLE:0,SELECT:1,PLAYING:2,WON:3},MainCtrl=function(t,n,a,e){this.characters=t.array,this.modalService=e,this.randomRollCount=20,this.resetGame()};MainCtrl.prototype.resetGame=function(){this.players=[];for(var t=0;t<this.characters.length;++t)this.characters[t].active=!1,this.characters[t].dead=!1,this.characters[t].winner=!1;this.activeChars=0,this.state=GAMESTATE.IDLE},MainCtrl.prototype.randomChars=function(){if(!(this.characters.length<this.randomRollCount)&&this.ensureState(GAMESTATE.IDLE))for(var t=0;t<this.randomRollCount;++t){var n=Math.floor(Math.random()*this.characters.length);this.characters[n].active?t--:(this.activeChars++,this.characters[n].active=!0)}},MainCtrl.prototype.reroll=function(){this.resetGame(),this.randomChars()},MainCtrl.prototype.ensureState=function(t){return this.state!=t?(console.log("subnormal"),!1):!0},MainCtrl.prototype.isIdle=function(){return this.state==GAMESTATE.IDLE},MainCtrl.prototype.isSelect=function(){return this.state==GAMESTATE.SELECT},MainCtrl.prototype.isPlaying=function(){return this.state==GAMESTATE.PLAYING},MainCtrl.prototype.isWon=function(){return this.state==GAMESTATE.WON},MainCtrl.prototype.incRandomRoll=function(){this.randomRollCount++},MainCtrl.prototype.decRandomRoll=function(){this.randomRollCount--},MainCtrl.prototype.canIncRandomRoll=function(){return this.randomRollCount<this.characters.length},MainCtrl.prototype.canDecRandomRoll=function(){return this.randomRollCount>1},MainCtrl.prototype.canStartPlaying=function(){return this.players.length>1&&this.state==GAMESTATE.SELECT},MainCtrl.prototype.canAddPlayers=function(){return this.activeChars>2&&this.state==GAMESTATE.IDLE},MainCtrl.prototype.beginAddPlayers=function(){this.state=GAMESTATE.SELECT},MainCtrl.prototype.beginGame=function(){this.ensureState(GAMESTATE.SELECT)&&(this.state=GAMESTATE.PLAYING)},MainCtrl.prototype.clickPJ=function(t){var n=this;if(this.state==GAMESTATE.IDLE&&(this.characters[t].active?(this.activeChars--,this.characters[t].active=!1):(this.activeChars++,this.characters[t].active=!0)),this.state==GAMESTATE.SELECT&&this.characters[t].active&&this.players.length<8){var a=this.modalService.open({animation:!0,templateUrl:"selectModal.html",controller:"SelectModalCtrl as modalCtrl",size:"sm",resolve:{selectedPJ:function(){return t},playerIndex:function(){return n.players.length+1}}});a.result.then(function(a){n.addPlayer(t,a)})}if(this.state==GAMESTATE.PLAYING){var e=this.modalService.open({animation:!0,templateUrl:"confirmModal.html",controller:"ConfirmModalCtrl as confirmModalCtrl",size:"sm",resolve:{selectedChar:function(){return n.characters[t]}}});e.result.then(function(){n.killPJ(t)})}},MainCtrl.prototype.killPJ=function(t){if(this.ensureState(GAMESTATE.PLAYING)&&!(0>t||t>this.characters.length)){var n=this.characters[t];n.active&&(n.dead=!0,this.checkFinish())}},MainCtrl.prototype.checkFinish=function(){for(var t=[],n=0;n<this.players.length;++n)this.characters[this.players[n].pj].dead||(t[this.players[n].pj]=!0);for(var a=0,e=-1,n=0;n<t.length;++n)t[n]===!0&&(++a,e=n);if(!(a>1)){if(0!==a){this.characters[e].winner=!0;for(var i=[],n=0;n<this.players.length;++n)this.players[n].pj==e&&(i[i.length]=this.players[n].name);this.modalService.open({animation:!0,templateUrl:"winnerModal.html",controller:"WinnerModalCtrl as winnerModalCtrl",size:"sm",resolve:{winners:function(){return i}}})}this.state=GAMESTATE.WON}},MainCtrl.prototype.addPlayer=function(t,n){this.players[this.players.length]={pj:t,name:n}};var SelectModalCtrl=function(t,n,a){this.playerIndex=t,this.selectedPJ=n,this.$uibModalInstance=a,this.playerName=""};SelectModalCtrl.prototype.sure=function(){""!==this.playerName&&this.$uibModalInstance.close(this.playerName)},SelectModalCtrl.prototype.nope=function(){this.$uibModalInstance.dismiss("S'ha cagat")};var ConfirmModalCtrl=function(t,n){this.selectedChar=t,console.log(t),this.$uibModalInstance=n};ConfirmModalCtrl.prototype.sure=function(){this.$uibModalInstance.close()},ConfirmModalCtrl.prototype.nope=function(){this.$uibModalInstance.dismiss()};var WinnerModalCtrl=function(t){this.players=t};angular.module("20wise").controller("MainCtrl",["characters","$http","$scope","$uibModal",MainCtrl]).controller("SelectModalCtrl",["playerIndex","selectedPJ","$uibModalInstance",SelectModalCtrl]).controller("ConfirmModalCtrl",["selectedChar","$uibModalInstance",ConfirmModalCtrl]).controller("WinnerModalCtrl",["winners",WinnerModalCtrl]);