angular.module("20wise",["ui.bootstrap"]);var CharacterService=function(){this.array=[{img:"bowser-jr.png",name:"Bowser Jr."},{img:"bowser.png",name:"Bowser"},{img:"captain-falcon.png",name:"Captain Falcon"},{img:"charizard.png",name:"Charizard"},{img:"dark-pit.png",name:"Dark Pit"},{img:"dedede.png",name:"King Dedede"},{img:"diddy.png",name:"Diddy Kong"},{img:"donkey.png",name:"Donkey Kong"},{img:"dr-mario.png",name:"Dr. Mario"},{img:"duck-hunt.png",name:"Duo Duck Hunt"},{img:"falco.png",name:"Falco"},{img:"fox.png",name:"Fox"},{img:"game-watch.png",name:"Game&Watch"},{img:"ganondorf.png",name:"Ganondorf"},{img:"greninja.png",name:"Greninja"},{img:"ike.png",name:"Ike"},{img:"jigglypuff.png",name:"Jigglypuff"},{img:"kirby.png",name:"Kirby"},{img:"link.png",name:"Link"},{img:"little-mac.png",name:"Little Mac"},{img:"lucario.png",name:"Lucario"},{img:"lucas.png",name:"Lucas"},{img:"lucina.png",name:"Lucina"},{img:"luigi.png",name:"Luigi"},{img:"mario.png",name:"Mario"},{img:"marth.png",name:"Marth"},{img:"mega-man.png",name:"Mega Man"},{img:"meta-knight.png",name:"Meta Knight"},{img:"mewtwo.png",name:"Mewtwo"},{img:"mii-brawler.png",name:"Mii Brawler"},{img:"mii-gunner.png",name:"Mii Gunner"},{img:"mii-swordfighter.png",name:"Mii Swordfighter"},{img:"ness.png",name:"Ness"},{img:"olimar.png",name:"Olimar"},{img:"pac-man.png",name:"Pac-Man"},{img:"palutena.png",name:"Palutena"},{img:"peach.png",name:"Peach"},{img:"pikachu.png",name:"Pikachu"},{img:"pit.png",name:"Pit"},{img:"robin.png",name:"Robin"},{img:"rob.png",name:"Rob"},{img:"rosalina.png",name:"Rosalina"},{img:"roy.png",name:"Roy"},{img:"ryu.png",name:"Ryu"},{img:"samus.png",name:"Samus"},{img:"sheik.png",name:"Sheik"},{img:"shulk.png",name:"Shulk"},{img:"sonic.png",name:"Sonic"},{img:"toon-link.png",name:"Toon Link"},{img:"villager.png",name:"Villager"},{img:"wario.png",name:"Wario"},{img:"wii-fit-trainer.png",name:"Wii Fit Trainer"},{img:"yoshi.png",name:"Yoshi"},{img:"zelda.png",name:"Zelda"},{img:"zero-suit-samus.png",name:"Zero Suit Samus"}]};angular.module("20wise").service("characters",[CharacterService]);var GAMESTATE={IDLE:0,SELECT:1,PLAYING:2,WON:3},MainCtrl=function(e,n,a,i){this.characters=e.array,this.modalService=i,this.resetGame()};MainCtrl.prototype.resetGame=function(){this.players=[];for(var e=0;e<this.characters.length;++e)this.characters[e].active=!1,this.characters[e].dead=!1,this.characters[e].winner=!1;this.state=GAMESTATE.IDLE},MainCtrl.prototype.randomChars=function(){if(!(this.characters.length<20)&&this.ensureState(GAMESTATE.IDLE)){for(var e=0;20>e;++e){var n=Math.floor(Math.random()*this.characters.length);this.characters[n].active?e--:this.characters[n].active=!0}this.state=GAMESTATE.SELECT}},MainCtrl.prototype.reroll=function(){this.resetGame(),this.randomChars()},MainCtrl.prototype.ensureState=function(e){return this.state!=e?(console.log("subnormal"),!1):!0},MainCtrl.prototype.isIdle=function(){return this.state==GAMESTATE.IDLE},MainCtrl.prototype.isSelect=function(){return this.state==GAMESTATE.SELECT},MainCtrl.prototype.isPlaying=function(){return this.state==GAMESTATE.PLAYING},MainCtrl.prototype.isWon=function(){return this.state==GAMESTATE.WON},MainCtrl.prototype.canStartPlaying=function(){return this.players.length>1&&this.state==GAMESTATE.SELECT},MainCtrl.prototype.beginGame=function(){this.ensureState(GAMESTATE.SELECT)&&(this.state=GAMESTATE.PLAYING)},MainCtrl.prototype.clickPJ=function(e){var n=this;if(this.state==GAMESTATE.SELECT&&this.characters[e].active&&this.players.length<8){var a=this.modalService.open({animation:!0,templateUrl:"selectModal.html",controller:"SelectModalCtrl as modalCtrl",size:"sm",resolve:{selectedPJ:function(){return e},playerIndex:function(){return n.players.length+1}}});a.result.then(function(a){n.addPlayer(e,a)})}this.state==GAMESTATE.PLAYING&&this.killPJ(e)},MainCtrl.prototype.killPJ=function(e){if(this.ensureState(GAMESTATE.PLAYING)&&!(0>e||e>this.characters.length)){var n=this.characters[e];n.active&&(n.dead=!0,this.checkFinish())}},MainCtrl.prototype.checkFinish=function(e){for(var n=[],e=0;e<this.players.length;++e)this.characters[this.players[e].pj].dead||(n[this.players[e].pj]=!0);for(var a=0,i=-1,e=0;e<n.length;++e)1==n[e]&&(++a,i=e);if(!(a>1)){if(0!=a){this.characters[i].winner=!0,winnersp=[];for(var e=0;e<this.players.length;++e)this.players[e].pj==i&&(winnersp[winnersp.length]=this.players[e].name);this.modalService.open({animation:!0,templateUrl:"winnerModal.html",controller:"WinnerModalCtrl as winnerModalCtrl",size:"sm",resolve:{winners:function(){return winnersp}}})}this.state=GAMESTATE.WON}},MainCtrl.prototype.addPlayer=function(e,n){this.players[this.players.length]={pj:e,name:n}};var SelectModalCtrl=function(e,n,a){this.playerIndex=e,this.selectedPJ=n,this.$uibModalInstance=a,this.playerName=""};SelectModalCtrl.prototype.sure=function(){""!=this.playerName&&this.$uibModalInstance.close(this.playerName)},SelectModalCtrl.prototype.nope=function(){this.$uibModalInstance.dismiss("S'ha cagat")};var WinnerModalCtrl=function(e){this.players=e};angular.module("20wise").controller("MainCtrl",["characters","$http","$scope","$uibModal",MainCtrl]).controller("SelectModalCtrl",["playerIndex","selectedPJ","$uibModalInstance",SelectModalCtrl]).controller("WinnerModalCtrl",["winners",WinnerModalCtrl]);